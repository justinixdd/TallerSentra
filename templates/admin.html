{% extends 'base.html' %}
{% block titulo %}Sentra: Menú Administrador{% endblock %}

{% block content %}
<main class="logregadm container py-4">
  <h1 class="mb-4 text-center">Gestión de Productos y Usuarios</h1>
  <h2 class="mb-5 text-center">Bienvenido, Admin</h2>

  <!-- ============================= -->
  <!-- Formulario para agregar producto/servicio -->
  <!-- ============================= -->
  <div class="card admin-card shadow-sm p-4 mb-5">
    <h3 class="mb-3 text-center">Agregar Producto o Servicio</h3>
    <form id="add-product-form" method="POST" enctype="multipart/form-data" action="{{ url_for('products') }}">
      <div class="mb-3">
        <label for="product-category" class="form-label">Categoría:</label>
        <select id="product-category" name="opciones" class="form-select" required>
          <option value="servicios">Servicios</option>
          <option value="piezas">Piezas</option>
        </select>
      </div>
      <div class="mb-3">
        <input type="text" name="product_name" class="form-control" placeholder="Nombre del producto" required>
      </div>
      <div class="mb-3">
        <input type="number" name="product_price" class="form-control" placeholder="Precio" required>
      </div>
      <div class="mb-3">
        <input type="text" name="product_description" class="form-control" placeholder="Descripción" required>
      </div>
      <div class="mb-3">
        <input type="number" name="product_quantity" class="form-control" placeholder="Cantidad" required>
      </div>
      <div class="mb-3">
        <input type="file" name="product_image" class="form-control" accept="image/*">
      </div>
      <button type="submit" class="btn btn-success w-100">Agregar</button>
    </form>
  </div>

  <!-- ============================= -->
  <!-- Tabla de Piezas -->
  <!-- ============================= -->
  <div class="admin-table mb-5">
    <h3 class="mb-3">Piezas</h3>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for pieza in piezas %}
          <tr>
            <td>
              {% if pieza.imagen_url %}
                <img src="{{ pieza.imagen_url }}" alt="{{ pieza.nombre }}" style="width:50px; border-radius:6px;">
              {% endif %}
            </td>
            <td>{{ pieza.nombre }}</td>
            <td>{{ pieza.descripcion }}</td>
            <td>₡{{ pieza.precio }}</td>
            <td>{{ pieza.cantidad }}</td>
            <td>
              <form method="POST" action="{{ url_for('eliminar_producto', categoria='piezas', id=pieza._id) }}">
                <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ============================= -->
  <!-- Tabla de Servicios -->
  <!-- ============================= -->
  <div class="admin-table mb-5">
    <h3 class="mb-3">Servicios</h3>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for servicio in servicios %}
          <tr>
            <td>
              {% if servicio.imagen_url %}
                <img src="{{ servicio.imagen_url }}" alt="{{ servicio.nombre }}" style="width:50px; border-radius:6px;">
              {% endif %}
            </td>
            <td>{{ servicio.nombre }}</td>
            <td>{{ servicio.descripcion }}</td>
            <td>₡{{ servicio.precio }}</td>
            <td>{{ servicio.cantidad }}</td>
            <td>
              <form method="POST" action="{{ url_for('eliminar_producto', categoria='servicios', id=servicio._id) }}">
                <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ============================= -->
  <!-- Tabla de Usuarios -->
  <!-- ============================= -->
  <div class="admin-table mb-5">
    <h3 class="mb-3">Usuarios</h3>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Es Admin</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.username }}</td>
            <td>{{ 'Sí' if user.is_admin else 'No' }}</td>
            <td>
              <form method="POST" action="{{ url_for('eliminar_usuario', id=user._id) }}">
                <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</main>

<!-- ============================= -->
<!-- ESTILOS ADAPTADOS A MODO OSCURO -->
<!-- ============================= -->
<style>
  .admin-card {
    background-color: rgba(255, 255, 255, 0.85);
    border-radius: 12px;
    transition: all 0.3s ease-in-out;
  }

  body.dark .admin-card {
    background-color: rgba(36, 37, 38, 0.8);
    color: #f1f1f1;
    backdrop-filter: blur(6px);
  }

  .admin-table h3 {
    color: #333;
  }
  body.dark .admin-table h3 {
    color: #fff;
  }

  .admin-table table {
    border-radius: 8px;
    overflow: hidden;
    color: #222;
  }

  body.dark .admin-table table {
    color: #f5f5f5;
    background-color: rgba(30,30,30,0.9);
  }

  .admin-table th {
    background-color: #ff7043;
    color: #fff;
  }

  body.dark .admin-table th {
    background-color: #ff7043;
    color: #fff;
  }

  .admin-table td, .admin-table th {
    vertical-align: middle;
  }

  .btn-success {
    background-color: #ff7043;
    border-color: #ff7043;
    transition: background-color 0.3s ease;
  }

  .btn-success:hover {
    background-color: #ff5722;
    border-color: #ff5722;
  }

  body.dark .btn-success {
    background-color: #ff7043;
    color: #fff;
  }

  .table-striped > tbody > tr:nth-of-type(odd) {
    background-color: rgba(255, 112, 67, 0.08);
  }

  body.dark .table-striped > tbody > tr:nth-of-type(odd) {
    background-color: rgba(255, 255, 255, 0.08);
  }

  /* Formularios */
  body.dark .form-control,
  body.dark .form-select {
    background-color: rgba(255,255,255,0.1);
    color: #fff;
    border: 1px solid #777;
  }

  body.dark .form-control::placeholder {
    color: #bbb;
  }

  /* Botón eliminar */
  .btn-danger {
    background-color: #e74c3c;
    border-color: #e74c3c;
  }
  .btn-danger:hover {
    background-color: #c0392b;
  }

  /* Suaviza la transición al cambiar tema */
  * {
    transition: background-color 0.3s ease, color 0.3s ease;
  }
</style>
{% endblock %}
